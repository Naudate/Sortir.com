{% extends 'base.html.twig' %}

{% block title %}Gestion des villes{% endblock %}


{% block body %}
<div class="mx-auto max-w-7xl px-4 py-6 sm:px-6 sm:py-12 lg:px-8">
    <div class="mx-auto max-w-2xl">
        <div class="space-y-6">
            <div class="border-b border-gray-900/10 pb-6">
                {{ form_start(form) }}

                {{ form_errors(form) }}
                <h2 class="text-base font-semibold leading-7 text-gray-900">
                    Création d'une ville
                </h2>
                <p class="mt-1 text-sm leading-6 text-gray-600">
                    Espace pour la création d'une ville.
                </p>
                <div class="mt-6 border-gray-100">
                    {{ form_label(form.codePostal, null, {
                        'label_attr' : { 'class': 'after:content-["*"] after:ml-0.5
                             after:text-red-500 text-gray-800'}
                    }) }}
                    {{ form_errors(form.codePostal) }}
                    {{ form_widget(form.codePostal) }}
                    {{ form_help(form.codePostal) }}
                </div>
                <div class="mt-6 border-gray-100">
                    {{ form_label(form.nom, null, {
                        'label_attr' : { 'class': 'after:content-["*"] after:ml-0.5
                             after:text-red-500 text-gray-800'}
                    }) }}
                    {{ form_errors(form.nom) }}
                    {{ form_widget(form.nom) }}
                    {{ form_help(form.nom) }}
                </div>
            </div>
            <div class="gap-y-8">
                <div class="flex mt-6 justify-end">
                    <button type="submit" class="rounded-md bg-indigo-600 px-3 py-2
                    text-sm font-semibold text-white shadow-sm hover:bg-indigo-500
                    focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2
                    focus-visible:outline-indigo-600">
                        Créer
                    </button>
                </div>
            </div>
            {{ form_end(form) }}
        </div>
    </div>
</div>




{% endblock %}


{% block javascripts %}


    <!-- Inclure jQuery (si ce n'est pas déjà fait) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Inclure le fichier JavaScript de jQuery UI Autocomplete -->
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <!-- Inclure le fichier CSS de jQuery UI Autocomplete (si nécessaire) -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">


    <script>
        $(document).ready(function() {
            var $loader = $('.autocomplete-loader');
            $('.autocompleteNom').autocomplete({
                source: function(request, response) {
                    console.log("nom");
                    $loader.show(); // Affichez le loader
                    $.ajax({
                        url: "{{ path('autocomplete_ville') }}",
                        dataType: 'json',
                        data: {
                            q: request.term
                        },
                        success: function(data) {
                            var suggestions = [];
                            data.forEach(function(item) {
                                item.codesPostaux.forEach(function(codePostal) {
                                    suggestions.push(codePostal+" - "+item.nom); // Ajoutez chaque code postal comme une suggestion distincte
                                });
                            });
                            response(suggestions);
                        },
                        complete: function() {
                            $loader.hide(); // Masquez le loader après la recherche
                        }
                    });
                },
                select: function(event, ui) {
                    var selectedValue = ui.item.value;
                    var parts = selectedValue.split(" - ");
                    var codePostal = parts[0];
                    var nom = parts[1];
                    // Remplissez les champs appropriés
                    $('#ville_codePostal').val(codePostal);
                    ui.item.value = nom;
                }
            });


            $('.autocompleteCodePostal').autocomplete({
                source: function(request, response) {
                    console.log("code");
                    $loader.show(); // Affichez le loader
                    $.ajax({
                        url: "{{ path('autocomplete_codePostal') }}",
                        dataType: 'json',
                        data: {
                            q: request.term
                        },
                        success: function(data) {
                            var suggestions = [];
                            console.log(data)
                            data.forEach(function(item) {
                                item.codesPostaux.forEach(function(codePostal) {
                                    suggestions.push(codePostal+" - "+item.nom); // Ajoutez chaque code postal comme une suggestion distincte
                                });
                            });
                            response(suggestions);
                        },
                        complete: function() {
                            $loader.hide(); // Masquez le loader après la recherche
                        }
                    });
                },
                select: function(event, ui) {
                    var selectedValue = ui.item.value;
                    var parts = selectedValue.split(" - ");
                    var codePostal = parts[0];
                    var nom = parts[1];
                    // Remplissez les champs appropriés
                    $('#ville_nom').val(nom);
                    ui.item.value = codePostal;
                }
            });
        });

    </script>
{% endblock %}

